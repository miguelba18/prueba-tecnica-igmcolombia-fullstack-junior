import{_ as R,c as a,a as e,d as y,e as S,v as I,p as L,t as c,F as x,k as _,n as h,w as k,u as M,l as g,h as V,m as j,S as v,r as z,o as r,f as H,g as O}from"./app-DTWS8Zmf.js";import{u as q}from"./user-B-J7oGgy.js";const G={name:"UserList",setup(){const d=q(),t=M(),w=g(()=>d.users),s=g(()=>d.loading),C=g(()=>d.error),b=g(()=>d.pagination),f=g(()=>{var o;return(o=t.user)==null?void 0:o.id}),n=V({search:"",role:""});let u=null;const p=async(o=1)=>{await d.fetchUsers(o)},P=()=>{d.setFilters(n),p(1)},U=()=>{clearTimeout(u),u=setTimeout(()=>{P()},500)},E=()=>{n.search="",n.role="",d.clearFilters(),p(1)},F=o=>{o>=1&&o<=b.value.lastPage&&(p(o),window.scrollTo({top:0,behavior:"smooth"}))},T=g(()=>{const o=b.value.currentPage,m=b.value.lastPage,l=[];if(m<=7)for(let i=1;i<=m;i++)l.push(i);else if(o<=4){for(let i=1;i<=5;i++)l.push(i);l.push("..."),l.push(m)}else if(o>=m-3){l.push(1),l.push("...");for(let i=m-4;i<=m;i++)l.push(i)}else{l.push(1),l.push("...");for(let i=o-1;i<=o+1;i++)l.push(i);l.push("..."),l.push(m)}return l}),B=o=>new Date(o).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}),D=o=>o==="admin"?"bg-warning text-dark":"bg-info",A=o=>o==="admin"?"Administrador":"Usuario",N=async o=>{if(o.id===f.value){v.fire("Acción no permitida","No puedes eliminar tu propio usuario.","warning");return}if((await v.fire({title:"¿Estás seguro?",text:`Se eliminará al usuario ${o.name}. Esta acción no se puede deshacer.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await d.deleteUser(o.id),await v.fire("Eliminado",`El usuario ${o.name} fue eliminado exitosamente.`,"success")}catch{v.fire("Error",d.error||"Hubo un problema al eliminar el usuario.","error")}};return j(()=>{p()}),{users:w,loading:s,error:C,pagination:b,currentUserId:f,filters:n,displayPages:T,applyFilters:P,debouncedSearch:U,clearFilters:E,changePage:F,formatDate:B,getRoleClass:D,getRoleText:A,confirmDelete:N}}},J={class:"user-list"},K={class:"card mb-4"},Q={class:"card-body"},W={class:"row g-3"},X={class:"col-md-6"},Y={class:"col-md-4"},Z={class:"col-md-2 d-flex align-items-end"},$={class:"card"},ee={class:"card-body"},te={key:0,class:"text-center py-5"},se={key:1,class:"alert alert-danger"},ne={key:2,class:"text-center py-5 text-muted"},oe={key:3},ie={class:"table-responsive"},le={class:"table table-hover"},ae=["href"],re={class:"text-end"},de={class:"btn-group btn-group-sm"},ce=["onClick","disabled"],ue={class:"d-flex justify-content-between align-items-center mt-3"},me={class:"text-muted"},ge={class:"pagination mb-0"},be=["onClick"];function fe(d,t,w,s,C,b){const f=z("router-link");return r(),a("div",J,[t[17]||(t[17]=e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e("h2",null,[e("i",{class:"bi bi-person-gear"}),y(" Usuarios "),e("span",{class:"badge bg-warning text-dark ms-2"},"Admin")])],-1)),e("div",K,[e("div",Q,[e("div",W,[e("div",X,[t[7]||(t[7]=e("label",{class:"form-label"},"Buscar",-1)),S(e("input",{type:"text",class:"form-control",placeholder:"Nombre o email...","onUpdate:modelValue":t[0]||(t[0]=n=>s.filters.search=n),onInput:t[1]||(t[1]=(...n)=>s.debouncedSearch&&s.debouncedSearch(...n))},null,544),[[I,s.filters.search]])]),e("div",Y,[t[9]||(t[9]=e("label",{class:"form-label"},"Rol",-1)),S(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=n=>s.filters.role=n),onChange:t[3]||(t[3]=(...n)=>s.applyFilters&&s.applyFilters(...n))},[...t[8]||(t[8]=[e("option",{value:""},"Todos",-1),e("option",{value:"admin"},"Administrador",-1),e("option",{value:"user"},"Usuario",-1)])],544),[[L,s.filters.role]])]),e("div",Z,[e("button",{onClick:t[4]||(t[4]=(...n)=>s.clearFilters&&s.clearFilters(...n)),class:"btn btn-outline-secondary w-100"},[...t[10]||(t[10]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),y(" Limpiar ",-1)])])])])])]),e("div",$,[e("div",ee,[s.loading?(r(),a("div",te,[...t[11]||(t[11]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Cargando...")],-1),e("p",{class:"mt-3 text-muted"},"Cargando usuarios...",-1)])])):s.error?(r(),a("div",se,[t[12]||(t[12]=e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),y(" "+c(s.error),1)])):s.users.length===0?(r(),a("div",ne,[...t[13]||(t[13]=[e("i",{class:"bi bi-person-x",style:{"font-size":"3rem"}},null,-1),e("p",{class:"mt-3"},"No se encontraron usuarios",-1)])])):(r(),a("div",oe,[e("div",ie,[e("table",le,[t[16]||(t[16]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Nombre"),e("th",null,"Email"),e("th",null,"Roles"),e("th",null,"Fecha de Registro"),e("th",{class:"text-end"},"Acciones")])],-1)),e("tbody",null,[(r(!0),a(x,null,_(s.users,n=>(r(),a("tr",{key:n.id},[e("td",null,c(n.id),1),e("td",null,[e("strong",null,c(n.name),1)]),e("td",null,[e("a",{href:`mailto:${n.email}`},c(n.email),9,ae)]),e("td",null,[(r(!0),a(x,null,_(n.roles,u=>(r(),a("span",{key:u,class:h([s.getRoleClass(u),"badge me-1"])},c(s.getRoleText(u)),3))),128))]),e("td",null,c(s.formatDate(n.created_at)),1),e("td",re,[e("div",de,[H(f,{to:`/users/${n.id}/edit`,class:"btn btn-outline-warning",title:"Editar"},{default:O(()=>[...t[14]||(t[14]=[e("i",{class:"bi bi-pencil"},"Editar",-1)])]),_:1},8,["to"]),e("button",{onClick:u=>s.confirmDelete(n),class:"btn btn-outline-danger",title:"Eliminar",disabled:n.id===s.currentUserId},[...t[15]||(t[15]=[e("i",{class:"bi bi-trash"},"Eliminar",-1)])],8,ce)])])]))),128))])])]),e("div",ue,[e("div",me," Mostrando "+c(s.users.length)+" de "+c(s.pagination.total)+" usuarios ",1),e("nav",null,[e("ul",ge,[e("li",{class:h(["page-item",{disabled:s.pagination.currentPage===1}])},[e("a",{class:"page-link",href:"#",onClick:t[5]||(t[5]=k(n=>s.changePage(s.pagination.currentPage-1),["prevent"]))}," Anterior ")],2),(r(!0),a(x,null,_(s.displayPages,n=>(r(),a("li",{key:n,class:h(["page-item",{active:n===s.pagination.currentPage}])},[e("a",{class:"page-link",href:"#",onClick:k(u=>s.changePage(n),["prevent"])},c(n),9,be)],2))),128)),e("li",{class:h(["page-item",{disabled:s.pagination.currentPage===s.pagination.lastPage}])},[e("a",{class:"page-link",href:"#",onClick:t[6]||(t[6]=k(n=>s.changePage(s.pagination.currentPage+1),["prevent"]))}," Siguiente ")],2)])])])]))])])])}const ve=R(G,[["render",fe],["__scopeId","data-v-ce021957"]]);export{ve as default};
