import{_ as O,c as i,a as t,f as C,d as v,g as _,r as H,e as p,v as h,p as E,F as k,k as w,t as r,n as x,w as F,l as y,i as q,h as G,m as J,S as P,o as d}from"./app-DTWS8Zmf.js";import{u as K}from"./invoice-XWfy-Ij-.js";import{u as Q}from"./customer-BgQvdGkx.js";const R={name:"InvoiceList",setup(){const u=K(),e=Q(),S=y(()=>u.invoices),l=y(()=>u.loading),T=y(()=>u.error),g=y(()=>u.pagination),m=q([]),s=G({search:"",status:"",customer_id:"",date_from:"",date_to:""});let f=null;const b=async(n=1)=>{await u.fetchInvoices(n)},N=async()=>{m.value=await e.fetchAllCustomers()},V=()=>{u.setFilters(s),b(1)},D=()=>{clearTimeout(f),f=setTimeout(()=>{V()},500)},B=()=>{s.search="",s.status="",s.customer_id="",s.date_from="",s.date_to="",u.clearFilters(),b(1)},I=n=>{n>=1&&n<=g.value.lastPage&&(b(n),window.scrollTo({top:0,behavior:"smooth"}))},L=y(()=>{const n=g.value.currentPage,c=g.value.lastPage,o=[];if(c<=7)for(let a=1;a<=c;a++)o.push(a);else if(n<=4){for(let a=1;a<=5;a++)o.push(a);o.push("..."),o.push(c)}else if(n>=c-3){o.push(1),o.push("...");for(let a=c-4;a<=c;a++)o.push(a)}else{o.push(1),o.push("...");for(let a=n-1;a<=n+1;a++)o.push(a);o.push("..."),o.push(c)}return o}),M=n=>new Date(n).toLocaleDateString("es-CO"),U=n=>new Intl.NumberFormat("es-CO").format(n),A=n=>({pending:"badge bg-warning text-dark",paid:"badge bg-success",overdue:"badge bg-danger"})[n]||"badge bg-secondary",j=n=>({pending:"Pendiente",paid:"Pagada",overdue:"Vencida"})[n]||n,z=async n=>{if((await P.fire({title:"¿Estás seguro?",text:`Se eliminará la factura ${n.invoice_number}. Esta acción no se puede deshacer.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await u.deleteInvoice(n.id),await P.fire("Eliminada",`La factura ${n.invoice_number} fue eliminada exitosamente.`,"success")}catch(o){P.fire("Error",`No se pudo eliminar la factura: ${o.message}`,"error")}};return J(()=>{b(),N()}),{invoices:S,loading:l,error:T,pagination:g,customers:m,filters:s,displayPages:L,applyFilters:V,debouncedSearch:D,clearFilters:B,changePage:I,formatDate:M,formatNumber:U,getStatusClass:A,getStatusText:j,confirmDelete:z}}},W={class:"invoice-list"},X={class:"d-flex justify-content-between align-items-center mb-4"},Y={class:"card mb-4"},Z={class:"card-body"},$={class:"row g-3"},tt={class:"col-md-3"},et={class:"col-md-2"},st={class:"col-md-3"},lt=["value"],nt={class:"col-md-2"},ot={class:"col-md-2"},at={class:"row mt-3"},it={class:"col-12"},rt={class:"card"},dt={class:"card-body"},ct={key:0,class:"text-center py-5"},ut={key:1,class:"alert alert-danger"},mt={key:2,class:"text-center py-5 text-muted"},ft={key:3},gt={class:"table-responsive"},bt={class:"table table-hover"},vt={class:"text-end"},pt={class:"btn-group btn-group-sm"},yt=["onClick"],Ct={class:"d-flex justify-content-between align-items-center mt-3"},_t={class:"text-muted"},xt={class:"pagination mb-0"},ht=["onClick"];function kt(u,e,S,l,T,g){const m=H("router-link");return d(),i("div",W,[t("div",X,[e[14]||(e[14]=t("h2",null,[t("i",{class:"bi bi-receipt"}),v(" Facturas ")],-1)),C(m,{to:"/invoices/create",class:"btn btn-primary"},{default:_(()=>[...e[13]||(e[13]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),v(" Nueva Factura ",-1)])]),_:1})]),t("div",Y,[t("div",Z,[t("div",$,[t("div",tt,[e[15]||(e[15]=t("label",{class:"form-label"},"Buscar",-1)),p(t("input",{type:"text",class:"form-control",placeholder:"Número de factura...","onUpdate:modelValue":e[0]||(e[0]=s=>l.filters.search=s),onInput:e[1]||(e[1]=(...s)=>l.debouncedSearch&&l.debouncedSearch(...s))},null,544),[[h,l.filters.search]])]),t("div",et,[e[17]||(e[17]=t("label",{class:"form-label"},"Estado",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=s=>l.filters.status=s),onChange:e[3]||(e[3]=(...s)=>l.applyFilters&&l.applyFilters(...s))},[...e[16]||(e[16]=[t("option",{value:""},"Todos",-1),t("option",{value:"pending"},"Pendiente",-1),t("option",{value:"paid"},"Pagada",-1),t("option",{value:"overdue"},"Vencida",-1)])],544),[[E,l.filters.status]])]),t("div",st,[e[19]||(e[19]=t("label",{class:"form-label"},"Cliente",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":e[4]||(e[4]=s=>l.filters.customer_id=s),onChange:e[5]||(e[5]=(...s)=>l.applyFilters&&l.applyFilters(...s))},[e[18]||(e[18]=t("option",{value:""},"Todos",-1)),(d(!0),i(k,null,w(l.customers,s=>(d(),i("option",{key:s.id,value:s.id},r(s.full_name),9,lt))),128))],544),[[E,l.filters.customer_id]])]),t("div",nt,[e[20]||(e[20]=t("label",{class:"form-label"},"Desde",-1)),p(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=s=>l.filters.date_from=s),onChange:e[7]||(e[7]=(...s)=>l.applyFilters&&l.applyFilters(...s))},null,544),[[h,l.filters.date_from]])]),t("div",ot,[e[21]||(e[21]=t("label",{class:"form-label"},"Hasta",-1)),p(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[8]||(e[8]=s=>l.filters.date_to=s),onChange:e[9]||(e[9]=(...s)=>l.applyFilters&&l.applyFilters(...s))},null,544),[[h,l.filters.date_to]])])]),t("div",at,[t("div",it,[t("button",{onClick:e[10]||(e[10]=(...s)=>l.clearFilters&&l.clearFilters(...s)),class:"btn btn-outline-secondary btn-sm"},[...e[22]||(e[22]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),v(" Limpiar Filtros ",-1)])])])])])]),t("div",rt,[t("div",dt,[l.loading?(d(),i("div",ct,[...e[23]||(e[23]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Cargando...")],-1),t("p",{class:"mt-3 text-muted"},"Cargando facturas...",-1)])])):l.error?(d(),i("div",ut,[e[24]||(e[24]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),v(" "+r(l.error),1)])):l.invoices.length===0?(d(),i("div",mt,[e[26]||(e[26]=t("i",{class:"bi bi-inbox",style:{"font-size":"3rem"}},null,-1)),e[27]||(e[27]=t("p",{class:"mt-3"},"No se encontraron facturas",-1)),C(m,{to:"/invoices/create",class:"btn btn-primary"},{default:_(()=>[...e[25]||(e[25]=[v(" Crear primera factura ",-1)])]),_:1})])):(d(),i("div",ft,[t("div",gt,[t("table",bt,[e[31]||(e[31]=t("thead",null,[t("tr",null,[t("th",null,"Número"),t("th",null,"Cliente"),t("th",null,"Fecha Emisión"),t("th",null,"Vencimiento"),t("th",null,"Monto Total"),t("th",null,"Estado"),t("th",{class:"text-end"},"Acciones")])],-1)),t("tbody",null,[(d(!0),i(k,null,w(l.invoices,s=>{var f;return d(),i("tr",{key:s.id},[t("td",null,[t("strong",null,r(s.invoice_number),1)]),t("td",null,r((f=s.customer)==null?void 0:f.full_name),1),t("td",null,r(l.formatDate(s.issue_date)),1),t("td",null,r(l.formatDate(s.due_date)),1),t("td",null,[t("strong",null,"$"+r(l.formatNumber(s.total_amount)),1)]),t("td",null,[t("span",{class:x(l.getStatusClass(s.status))},r(l.getStatusText(s.status)),3)]),t("td",vt,[t("div",pt,[C(m,{to:`/invoices/${s.id}`,class:"btn btn-outline-info",title:"Ver detalle"},{default:_(()=>[...e[28]||(e[28]=[t("i",{class:"bi bi-eye"},"Ver",-1)])]),_:1},8,["to"]),C(m,{to:`/invoices/${s.id}/edit`,class:"btn btn-outline-warning",title:"Editar"},{default:_(()=>[...e[29]||(e[29]=[t("i",{class:"bi bi-pencil"},"Editar",-1)])]),_:1},8,["to"]),t("button",{onClick:b=>l.confirmDelete(s),class:"btn btn-outline-danger",title:"Eliminar"},[...e[30]||(e[30]=[t("i",{class:"bi bi-trash"},"Eliminar",-1)])],8,yt)])])])}),128))])])]),t("div",Ct,[t("div",_t," Mostrando "+r(l.invoices.length)+" de "+r(l.pagination.total)+" facturas ",1),t("nav",null,[t("ul",xt,[t("li",{class:x(["page-item",{disabled:l.pagination.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:e[11]||(e[11]=F(s=>l.changePage(l.pagination.currentPage-1),["prevent"]))}," Anterior ")],2),(d(!0),i(k,null,w(l.displayPages,s=>(d(),i("li",{key:s,class:x(["page-item",{active:s===l.pagination.currentPage}])},[t("a",{class:"page-link",href:"#",onClick:F(f=>l.changePage(s),["prevent"])},r(s),9,ht)],2))),128)),t("li",{class:x(["page-item",{disabled:l.pagination.currentPage===l.pagination.lastPage}])},[t("a",{class:"page-link",href:"#",onClick:e[12]||(e[12]=F(s=>l.changePage(l.pagination.currentPage+1),["prevent"]))}," Siguiente ")],2)])])])]))])])])}const St=O(R,[["render",kt],["__scopeId","data-v-ec36f885"]]);export{St as default};
