import{_ as D,c as r,a as e,f as h,d as g,g as C,r as V,e as w,v as M,p as A,y as I,t as d,F as P,k as E,n as _,w as y,l as b,h as L,m as j,S as x,o as c}from"./app-DTWS8Zmf.js";import{u as z}from"./customer-BgQvdGkx.js";const U={name:"CustomerList",setup(){const a=z(),t=b(()=>a.customers),k=b(()=>a.loading),n=b(()=>a.error),p=b(()=>a.pagination),f=L({search:"",document_type:""});let m=null;const s=async(l=1)=>{await a.fetchCustomers(l)},v=()=>{a.setFilters(f),s(1)},T=()=>{clearTimeout(m),m=setTimeout(()=>{v()},500)},S=()=>{f.search="",f.document_type="",a.clearFilters(),s(1)},N=l=>{l>=1&&l<=p.value.lastPage&&(s(l),window.scrollTo({top:0,behavior:"smooth"}))},F=b(()=>{const l=p.value.currentPage,u=p.value.lastPage,i=[];if(u<=7)for(let o=1;o<=u;o++)i.push(o);else if(l<=4){for(let o=1;o<=5;o++)i.push(o);i.push("..."),i.push(u)}else if(l>=u-3){i.push(1),i.push("...");for(let o=u-4;o<=u;o++)i.push(o)}else{i.push(1),i.push("...");for(let o=l-1;o<=l+1;o++)i.push(o);i.push("..."),i.push(u)}return i}),B=async l=>{if((await x.fire({title:"¿Estás seguro?",text:`Se eliminará al cliente ${l.full_name}.

Nota: No se puede eliminar si tiene facturas asociadas.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await a.deleteCustomer(l.id),await x.fire("Eliminado",`El cliente ${l.full_name} fue eliminado exitosamente.`,"success")}catch{x.fire("Error",a.error||"Error al eliminar el cliente.","error")}};return j(()=>{s()}),{customers:t,loading:k,error:n,pagination:p,filters:f,displayPages:F,applyFilters:v,debouncedSearch:T,clearFilters:S,changePage:N,confirmDelete:B}}},q={class:"customer-list"},G={class:"d-flex justify-content-between align-items-center mb-4"},H={class:"card mb-4"},J={class:"card-body"},K={class:"row g-3"},O={class:"col-md-6"},Q={class:"col-md-4"},R={class:"col-md-2 d-flex align-items-end"},W={class:"card"},X={class:"card-body"},Y={key:0,class:"text-center py-5"},Z={key:1,class:"alert alert-danger"},$={key:2,class:"text-center py-5 text-muted"},ee={key:3},te={class:"table-responsive"},se={class:"table table-hover"},ne={class:"badge bg-secondary"},oe=["href"],le={class:"text-end"},ie={class:"btn-group btn-group-sm"},ae=["onClick"],re={class:"d-flex justify-content-between align-items-center mt-3"},de={class:"text-muted"},ce={class:"pagination mb-0"},ue=["onClick"];function me(a,t,k,n,p,f){const m=V("router-link");return c(),r("div",q,[e("div",G,[t[8]||(t[8]=e("h2",null,[e("i",{class:"bi bi-people"}),g(" Clientes")],-1)),h(m,{to:"/customers/create",class:"btn btn-success"},{default:C(()=>[...t[7]||(t[7]=[e("i",{class:"bi bi-person-plus me-2"},null,-1),g(" Nuevo Cliente ",-1)])]),_:1})]),e("div",H,[e("div",J,[e("div",K,[e("div",O,[t[9]||(t[9]=e("label",{class:"form-label"},"Buscar",-1)),w(e("input",{type:"text",class:"form-control",placeholder:"Nombre, email o documento...","onUpdate:modelValue":t[0]||(t[0]=s=>n.filters.search=s),onInput:t[1]||(t[1]=(...s)=>n.debouncedSearch&&n.debouncedSearch(...s))},null,544),[[M,n.filters.search]])]),e("div",Q,[t[11]||(t[11]=e("label",{class:"form-label"},"Tipo de Documento",-1)),w(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=s=>n.filters.document_type=s),onChange:t[3]||(t[3]=(...s)=>n.applyFilters&&n.applyFilters(...s))},[...t[10]||(t[10]=[I('<option value="" data-v-ff7e47a1>Todos</option><option value="CC" data-v-ff7e47a1> Cédula de Ciudadanía (CC) </option><option value="NIT" data-v-ff7e47a1>NIT</option><option value="CE" data-v-ff7e47a1> Cédula de Extranjería (CE) </option><option value="PA" data-v-ff7e47a1>Pasaporte (PA)</option>',5)])],544),[[A,n.filters.document_type]])]),e("div",R,[e("button",{onClick:t[4]||(t[4]=(...s)=>n.clearFilters&&n.clearFilters(...s)),class:"btn btn-outline-secondary w-100"},[...t[12]||(t[12]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),g(" Limpiar ",-1)])])])])])]),e("div",W,[e("div",X,[n.loading?(c(),r("div",Y,[...t[13]||(t[13]=[e("div",{class:"spinner-border text-success",role:"status"},[e("span",{class:"visually-hidden"},"Cargando...")],-1),e("p",{class:"mt-3 text-muted"},"Cargando clientes...",-1)])])):n.error?(c(),r("div",Z,[t[14]||(t[14]=e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),g(" "+d(n.error),1)])):n.customers.length===0?(c(),r("div",$,[t[16]||(t[16]=e("i",{class:"bi bi-person-x",style:{"font-size":"3rem"}},null,-1)),t[17]||(t[17]=e("p",{class:"mt-3"},"No se encontraron clientes",-1)),h(m,{to:"/customers/create",class:"btn btn-success"},{default:C(()=>[...t[15]||(t[15]=[g(" Crear primer cliente ",-1)])]),_:1})])):(c(),r("div",ee,[e("div",te,[e("table",se,[t[20]||(t[20]=e("thead",null,[e("tr",null,[e("th",null,"Nombre Completo"),e("th",null,"Tipo Doc."),e("th",null,"Documento"),e("th",null,"Email"),e("th",null,"Teléfono"),e("th",{class:"text-end"},"Acciones")])],-1)),e("tbody",null,[(c(!0),r(P,null,E(n.customers,s=>(c(),r("tr",{key:s.id},[e("td",null,[e("strong",null,d(s.full_name),1)]),e("td",null,[e("span",ne,d(s.document_type),1)]),e("td",null,d(s.document_number),1),e("td",null,[e("a",{href:`mailto:${s.email}`},d(s.email),9,oe)]),e("td",null,d(s.phone||"-"),1),e("td",le,[e("div",ie,[h(m,{to:`/customers/${s.id}/edit`,class:"btn btn-outline-warning",title:"Editar"},{default:C(()=>[...t[18]||(t[18]=[e("i",{class:"bi bi-pencil"},"Editar",-1)])]),_:1},8,["to"]),e("button",{onClick:v=>n.confirmDelete(s),class:"btn btn-outline-danger",title:"Eliminar"},[...t[19]||(t[19]=[e("i",{class:"bi bi-trash"},"Eliminar",-1)])],8,ae)])])]))),128))])])]),e("div",re,[e("div",de," Mostrando "+d(n.customers.length)+" de "+d(n.pagination.total)+" clientes ",1),e("nav",null,[e("ul",ce,[e("li",{class:_(["page-item",{disabled:n.pagination.currentPage===1}])},[e("a",{class:"page-link",href:"#",onClick:t[5]||(t[5]=y(s=>n.changePage(n.pagination.currentPage-1),["prevent"]))}," Anterior ")],2),(c(!0),r(P,null,E(n.displayPages,s=>(c(),r("li",{key:s,class:_(["page-item",{active:s===n.pagination.currentPage}])},[e("a",{class:"page-link",href:"#",onClick:y(v=>n.changePage(s),["prevent"])},d(s),9,ue)],2))),128)),e("li",{class:_(["page-item",{disabled:n.pagination.currentPage===n.pagination.lastPage}])},[e("a",{class:"page-link",href:"#",onClick:t[6]||(t[6]=y(s=>n.changePage(n.pagination.currentPage+1),["prevent"]))}," Siguiente ")],2)])])])]))])])])}const ge=D(U,[["render",me],["__scopeId","data-v-ff7e47a1"]]);export{ge as default};
