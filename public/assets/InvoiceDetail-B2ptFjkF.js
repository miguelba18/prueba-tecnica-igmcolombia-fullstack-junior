import{_ as T,c as a,b as d,a as t,d as i,t as o,f as h,g as w,r as I,n as C,F as B,k as V,i as f,m as F,q as A,S as u,j as p,o as r}from"./app-CBNaHwnX.js";import{u as L}from"./invoice-BP9D02IR.js";const P={name:"InvoiceDetail",setup(){const x=A(),s=p(),m=L(),n=f(null),b=f(!1),v=f(null),c=f(!1),g=async()=>{b.value=!0,v.value=null;try{n.value=await m.fetchInvoice(x.params.id)}catch{v.value="Error al cargar la factura"}finally{b.value=!1}},l=async e=>{if((await u.fire({title:"¿Estás seguro?",text:`El estado cambiará a ${y(e)}.`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, cambiar",cancelButtonText:"Cancelar"})).isConfirmed){c.value=!0;try{await m.changeInvoiceStatus(n.value.id,e),n.value.status=e,await u.fire("Estado actualizado","El estado de la factura fue cambiado exitosamente","success")}catch{u.fire("Error","No se pudo cambiar el estado","error")}finally{c.value=!1}}},S=async()=>{if((await u.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await m.deleteInvoice(n.value.id),await u.fire("Eliminada","La factura fue eliminada exitosamente","success"),s.push("/invoices")}catch{u.fire("Error","Hubo un problema al eliminar la factura","error")}},k=e=>new Date(e).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}),D=e=>new Date(e).toLocaleString("es-CO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=e=>new Intl.NumberFormat("es-CO").format(e||0),N=e=>({pending:"badge bg-warning text-dark",paid:"badge bg-success",overdue:"badge bg-danger"})[e]||"badge bg-secondary",y=e=>({pending:"Pendiente",paid:"Pagada",overdue:"Vencida"})[e]||e;return F(()=>{g()}),{invoice:n,loading:b,error:v,changingStatus:c,changeStatus:l,confirmDelete:S,formatDate:k,formatDateTime:D,formatNumber:E,getStatusClass:N,getStatusText:y}}},M={class:"invoice-detail"},O={key:0,class:"text-center py-5"},j={key:1,class:"alert alert-danger"},q={key:2},z={class:"d-flex justify-content-between align-items-center mb-4"},R={class:"btn-group"},H={class:"card mb-4"},U={class:"card-body"},G={class:"row align-items-center"},J={class:"col-md-6"},K={class:"col-md-6 text-end"},Q={class:"btn-group"},W=["disabled"],X=["disabled"],Y=["disabled"],Z={class:"row"},$={class:"col-md-8"},tt={class:"card mb-4"},st={class:"card-body"},nt={class:"row mb-3"},ot={class:"col-md-6"},it={class:"text-primary fs-5"},et={class:"col-md-6"},lt={class:"row mb-3"},at={class:"col-md-6"},rt={class:"col-md-6"},dt={key:0,class:"badge bg-danger ms-2"},ct={key:0,class:"row mb-3"},ut={class:"col-12"},mt={key:1,class:"row"},bt={class:"col-12"},vt={class:"card mb-4"},gt={class:"card-body"},ft={class:"row mb-2"},_t={class:"col-md-6"},xt={class:"col-md-6"},yt={class:"row mb-2"},ht={class:"col-md-6"},wt=["href"],Ct={key:0,class:"col-md-6"},St={key:0,class:"row"},kt={class:"col-12"},Dt={class:"card mb-4"},Et={class:"card-body p-0"},Nt={class:"table-responsive"},Tt={class:"table table-hover mb-0"},It={class:"text-muted"},Bt={class:"text-center"},Vt={class:"text-end"},Ft={class:"text-center"},At={class:"text-end"},pt={class:"text-end"},Lt={class:"col-md-4"},Pt={class:"card mb-4"},Mt={class:"card-body"},Ot={class:"table table-sm mb-0"},jt={class:"text-end"},qt={class:"text-end"},zt={class:"table-primary"},Rt={class:"text-end"},Ht={class:"fs-5"},Ut={key:0,class:"card mb-4"},Gt={class:"card-body"},Jt=["href"],Kt={class:"card"},Qt={class:"card-body"},Wt={class:"mb-2"},Xt={class:"mb-2"},Yt={class:"mb-0"};function Zt(x,s,m,n,b,v){var g;const c=I("router-link");return r(),a("div",M,[n.loading?(r(),a("div",O,[...s[4]||(s[4]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Cargando...")],-1),t("p",{class:"mt-3 text-muted"},"Cargando factura...",-1)])])):n.error?(r(),a("div",j,[s[5]||(s[5]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),i(" "+o(n.error),1)])):n.invoice?(r(),a("div",q,[t("div",z,[t("h2",null,[s[6]||(s[6]=t("i",{class:"bi bi-receipt"},null,-1)),i(" Factura "+o(n.invoice.invoice_number),1)]),t("div",R,[h(c,{to:"/invoices",class:"btn btn-outline-secondary"},{default:w(()=>[...s[7]||(s[7]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),i(" Volver ",-1)])]),_:1}),h(c,{to:`/invoices/${n.invoice.id}/edit`,class:"btn btn-warning"},{default:w(()=>[...s[8]||(s[8]=[t("i",{class:"bi bi-pencil me-2"},null,-1),i(" Editar ",-1)])]),_:1},8,["to"]),t("button",{onClick:s[0]||(s[0]=(...l)=>n.confirmDelete&&n.confirmDelete(...l)),class:"btn btn-danger"},[...s[9]||(s[9]=[t("i",{class:"bi bi-trash me-2"},null,-1),i(" Eliminar ",-1)])])])]),t("div",H,[t("div",U,[t("div",G,[t("div",J,[t("h5",null,[s[10]||(s[10]=i(" Estado Actual: ",-1)),t("span",{class:C([n.getStatusClass(n.invoice.status),"ms-2"])},o(n.getStatusText(n.invoice.status)),3)])]),t("div",K,[t("div",Q,[t("button",{onClick:s[1]||(s[1]=l=>n.changeStatus("pending")),class:"btn btn-sm btn-warning",disabled:n.invoice.status==="pending"||n.changingStatus}," Marcar Pendiente ",8,W),t("button",{onClick:s[2]||(s[2]=l=>n.changeStatus("paid")),class:"btn btn-sm btn-success",disabled:n.invoice.status==="paid"||n.changingStatus}," Marcar Pagada ",8,X),t("button",{onClick:s[3]||(s[3]=l=>n.changeStatus("overdue")),class:"btn btn-sm btn-danger",disabled:n.invoice.status==="overdue"||n.changingStatus}," Marcar Vencida ",8,Y)])])])])]),t("div",Z,[t("div",$,[t("div",tt,[s[23]||(s[23]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-info-circle me-2"}),i(" Información de la Factura ")])],-1)),t("div",st,[t("div",nt,[t("div",ot,[s[11]||(s[11]=t("strong",null,"Número de Factura:",-1)),s[12]||(s[12]=t("br",null,null,-1)),t("span",it,o(n.invoice.invoice_number),1)]),t("div",et,[s[13]||(s[13]=t("strong",null,"Estado:",-1)),s[14]||(s[14]=t("br",null,null,-1)),t("span",{class:C(n.getStatusClass(n.invoice.status))},o(n.getStatusText(n.invoice.status)),3)])]),t("div",lt,[t("div",at,[s[15]||(s[15]=t("strong",null,"Fecha de Emisión:",-1)),s[16]||(s[16]=t("br",null,null,-1)),i(" "+o(n.formatDate(n.invoice.issue_date)),1)]),t("div",rt,[s[17]||(s[17]=t("strong",null,"Fecha de Vencimiento:",-1)),s[18]||(s[18]=t("br",null,null,-1)),i(" "+o(n.formatDate(n.invoice.due_date))+" ",1),n.invoice.is_overdue?(r(),a("span",dt," Vencida ")):d("",!0)])]),n.invoice.description?(r(),a("div",ct,[t("div",ut,[s[19]||(s[19]=t("strong",null,"Descripción:",-1)),s[20]||(s[20]=t("br",null,null,-1)),i(" "+o(n.invoice.description),1)])])):d("",!0),n.invoice.notes?(r(),a("div",mt,[t("div",bt,[s[21]||(s[21]=t("strong",null,"Notas:",-1)),s[22]||(s[22]=t("br",null,null,-1)),i(" "+o(n.invoice.notes),1)])])):d("",!0)])]),t("div",vt,[s[34]||(s[34]=t("div",{class:"card-header bg-success text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-person me-2"}),i(" Información del Cliente ")])],-1)),t("div",gt,[t("div",ft,[t("div",_t,[s[24]||(s[24]=t("strong",null,"Nombre:",-1)),s[25]||(s[25]=t("br",null,null,-1)),i(" "+o(n.invoice.customer.full_name),1)]),t("div",xt,[s[26]||(s[26]=t("strong",null,"Documento:",-1)),s[27]||(s[27]=t("br",null,null,-1)),i(" "+o(n.invoice.customer.document_type)+" - "+o(n.invoice.customer.document_number),1)])]),t("div",yt,[t("div",ht,[s[28]||(s[28]=t("strong",null,"Email:",-1)),s[29]||(s[29]=t("br",null,null,-1)),t("a",{href:`mailto:${n.invoice.customer.email}`},o(n.invoice.customer.email),9,wt)]),n.invoice.customer.phone?(r(),a("div",Ct,[s[30]||(s[30]=t("strong",null,"Teléfono:",-1)),s[31]||(s[31]=t("br",null,null,-1)),i(" "+o(n.invoice.customer.phone),1)])):d("",!0)]),n.invoice.customer.address?(r(),a("div",St,[t("div",kt,[s[32]||(s[32]=t("strong",null,"Dirección:",-1)),s[33]||(s[33]=t("br",null,null,-1)),i(" "+o(n.invoice.customer.address),1)])])):d("",!0)])]),t("div",Dt,[s[37]||(s[37]=t("div",{class:"card-header bg-info text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-list-ul me-2"}),i(" Items de la Factura ")])],-1)),t("div",Et,[t("div",Nt,[t("table",Tt,[s[36]||(s[36]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Descripción"),t("th",{class:"text-center"}," Cantidad "),t("th",{class:"text-end"}," Precio Unit. "),t("th",{class:"text-center"},"IVA"),t("th",{class:"text-end"},"Subtotal"),t("th",{class:"text-end"},"Total")])],-1)),t("tbody",null,[(r(!0),a(B,null,V(n.invoice.items,l=>(r(),a("tr",{key:l.id},[t("td",null,[t("strong",null,o(l.name),1),s[35]||(s[35]=t("br",null,null,-1)),t("small",It,o(l.description),1)]),t("td",Bt,o(l.quantity),1),t("td",Vt," $"+o(n.formatNumber(l.unit_price)),1),t("td",Ft,o(l.tax_rate)+"% ",1),t("td",At," $"+o(n.formatNumber(l.subtotal)),1),t("td",pt,[t("strong",null,"$"+o(n.formatNumber(l.total)),1)])]))),128))])])])])])]),t("div",Lt,[t("div",Pt,[s[41]||(s[41]=t("div",{class:"card-header bg-dark text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-calculator me-2"}),i(" Totales ")])],-1)),t("div",Mt,[t("table",Ot,[t("tr",null,[s[38]||(s[38]=t("td",null,[t("strong",null,"Subtotal:")],-1)),t("td",jt," $"+o(n.formatNumber(n.invoice.subtotal)),1)]),t("tr",null,[s[39]||(s[39]=t("td",null,[t("strong",null,"IVA:")],-1)),t("td",qt," $"+o(n.formatNumber(n.invoice.tax_amount)),1)]),t("tr",zt,[s[40]||(s[40]=t("td",null,[t("strong",null,"TOTAL:")],-1)),t("td",Rt,[t("strong",Ht,"$"+o(n.formatNumber(n.invoice.total_amount)),1)])])])])]),n.invoice.attachment_path?(r(),a("div",Ut,[s[43]||(s[43]=t("div",{class:"card-header"},[t("h6",{class:"mb-0"},[t("i",{class:"bi bi-paperclip me-2"}),i(" Archivo Adjunto ")])],-1)),t("div",Gt,[t("a",{href:n.invoice.attachment_path,target:"_blank",class:"btn btn-outline-primary w-100"},[...s[42]||(s[42]=[t("i",{class:"bi bi-download me-2"},null,-1),i(" Descargar Archivo ",-1)])],8,Jt)])])):d("",!0),t("div",Kt,[s[50]||(s[50]=t("div",{class:"card-header"},[t("h6",{class:"mb-0"},[t("i",{class:"bi bi-clock-history me-2"}),i(" Información Adicional ")])],-1)),t("div",Qt,[t("p",Wt,[s[44]||(s[44]=t("strong",null,"Creado por:",-1)),s[45]||(s[45]=t("br",null,null,-1)),i(" "+o((g=n.invoice.user)==null?void 0:g.name),1)]),t("p",Xt,[s[46]||(s[46]=t("strong",null,"Fecha de creación:",-1)),s[47]||(s[47]=t("br",null,null,-1)),i(" "+o(n.formatDateTime(n.invoice.created_at)),1)]),t("p",Yt,[s[48]||(s[48]=t("strong",null,"Última actualización:",-1)),s[49]||(s[49]=t("br",null,null,-1)),i(" "+o(n.formatDateTime(n.invoice.updated_at)),1)])])])])])])):d("",!0)])}const ns=T(P,[["render",Zt],["__scopeId","data-v-bf79b7eb"]]);export{ns as default};
