import{s as u,x as l}from"./app-CBNaHwnX.js";const p=u("invoice",{state:()=>({invoices:[],currentInvoice:null,loading:!1,error:null,pagination:{currentPage:1,lastPage:1,perPage:15,total:0},filters:{status:"",customer_id:"",search:"",date_from:"",date_to:"",sort_by:"created_at",sort_order:"desc"}}),getters:{pendingInvoices:e=>e.invoices.filter(a=>a.status==="pending"),paidInvoices:e=>e.invoices.filter(a=>a.status==="paid"),overdueInvoices:e=>e.invoices.filter(a=>a.status==="overdue"),totalAmount:e=>e.invoices.reduce((a,s)=>a+parseFloat(s.total_amount),0)},actions:{async fetchInvoices(e=1){var a,s;this.loading=!0,this.error=null;try{const t={page:e,per_page:this.pagination.perPage,...this.filters};Object.keys(t).forEach(r=>{(t[r]===""||t[r]===null)&&delete t[r]});const i=await l.list(t);return this.invoices=i.data.data,this.pagination={currentPage:i.data.meta.current_page,lastPage:i.data.meta.last_page,perPage:i.data.meta.per_page,total:i.data.meta.total},i.data}catch(t){throw this.error=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Error al cargar facturas",t}finally{this.loading=!1}},async fetchInvoice(e){var a,s;this.loading=!0,this.error=null;try{const t=await l.get(e);return this.currentInvoice=t.data.data,t.data.data}catch(t){throw this.error=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Error al cargar factura",t}finally{this.loading=!1}},async createInvoice(e){var a,s;this.loading=!0,this.error=null;try{const t=new FormData;Object.keys(e).forEach(r=>{r!=="items"&&r!=="attachment"&&t.append(r,e[r])}),e.items&&e.items.length>0&&e.items.forEach((r,o)=>{Object.keys(r).forEach(c=>{t.append(`items[${o}][${c}]`,r[c])})}),e.attachment&&t.append("attachment",e.attachment);const i=await l.create(t);return await this.fetchInvoices(this.pagination.currentPage),i.data}catch(t){throw this.error=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Error al crear factura",t}finally{this.loading=!1}},async updateInvoice(e,a){var s,t,i;this.loading=!0,this.error=null;try{const r=new FormData;Object.keys(a).forEach(n=>{n!=="items"&&n!=="attachment"&&r.append(n,a[n])}),a.items&&a.items.length>0&&a.items.forEach((n,d)=>{Object.keys(n).forEach(h=>{r.append(`items[${d}][${h}]`,n[h])})}),a.attachment instanceof File&&r.append("attachment",a.attachment),r.append("_method","PUT");const o=await l.update(e,r,{headers:{"Content-Type":"multipart/form-data"}}),c=this.invoices.findIndex(n=>n.id===e);return c!==-1&&(this.invoices[c]=o.data.data),((s=this.currentInvoice)==null?void 0:s.id)===e&&(this.currentInvoice=o.data.data),o.data}catch(r){throw this.error=((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||"Error al actualizar factura",r}finally{this.loading=!1}},async deleteInvoice(e){var a,s;this.loading=!0,this.error=null;try{return await l.delete(e),this.invoices=this.invoices.filter(t=>t.id!==e),this.pagination.total--,!0}catch(t){throw this.error=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Error al eliminar factura",t}finally{this.loading=!1}},async changeInvoiceStatus(e,a){var s,t,i;this.loading=!0,this.error=null;try{const r=await l.changeStatus(e,a),o=this.invoices.findIndex(c=>c.id===e);return o!==-1&&(this.invoices[o]=r.data.data),((s=this.currentInvoice)==null?void 0:s.id)===e&&(this.currentInvoice=r.data.data),r.data}catch(r){throw this.error=((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||"Error al cambiar estado",r}finally{this.loading=!1}},setFilters(e){this.filters={...this.filters,...e}},clearFilters(){this.filters={status:"",customer_id:"",search:"",date_from:"",date_to:"",sort_by:"created_at",sort_order:"desc"}},clearCurrentInvoice(){this.currentInvoice=null}}});export{p as u};
