import{s as d,z as n}from"./app-CBNaHwnX.js";const g=d("customer",{state:()=>({customers:[],currentCustomer:null,loading:!1,error:null,pagination:{currentPage:1,lastPage:1,perPage:15,total:0},filters:{search:"",document_type:"",sort_by:"created_at",sort_order:"desc"}}),getters:{customersByType:t=>s=>t.customers.filter(e=>e.document_type===s),getCustomerById:t=>s=>t.customers.find(e=>e.id===s)},actions:{async fetchCustomers(t=1){var s,e;this.loading=!0,this.error=null;try{const r={page:t,per_page:this.pagination.perPage,...this.filters};Object.keys(r).forEach(a=>{(r[a]===""||r[a]===null)&&delete r[a]});const o=await n.list(r);return this.customers=o.data.data,this.pagination={currentPage:o.data.meta.current_page,lastPage:o.data.meta.last_page,perPage:o.data.meta.per_page,total:o.data.meta.total},o.data}catch(r){throw this.error=((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al cargar clientes",r}finally{this.loading=!1}},async fetchAllCustomers(){try{return(await n.list({per_page:1e3})).data.data}catch(t){return console.error("Error al cargar clientes:",t),[]}},async fetchCustomer(t){var s,e;this.loading=!0,this.error=null;try{const r=await n.get(t);return this.currentCustomer=r.data.data,r.data.data}catch(r){throw this.error=((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al cargar cliente",r}finally{this.loading=!1}},async createCustomer(t){var s,e,r,o;this.loading=!0,this.error=null;try{const a=await n.create(t);return await this.fetchCustomers(this.pagination.currentPage),a.data}catch(a){if(this.error=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al crear cliente",(o=(r=a.response)==null?void 0:r.data)!=null&&o.errors){const l=a.response.data.errors,i=Object.values(l).flat().join(", ");this.error=i}throw a}finally{this.loading=!1}},async updateCustomer(t,s){var e,r,o,a,l;this.loading=!0,this.error=null;try{const i=await n.update(t,s),c=this.customers.findIndex(u=>u.id===t);return c!==-1&&(this.customers[c]=i.data.data),((e=this.currentCustomer)==null?void 0:e.id)===t&&(this.currentCustomer=i.data.data),i.data}catch(i){if(this.error=((o=(r=i.response)==null?void 0:r.data)==null?void 0:o.message)||"Error al actualizar cliente",(l=(a=i.response)==null?void 0:a.data)!=null&&l.errors){const c=i.response.data.errors,u=Object.values(c).flat().join(", ");this.error=u}throw i}finally{this.loading=!1}},async deleteCustomer(t){var s,e;this.loading=!0,this.error=null;try{return await n.delete(t),this.customers=this.customers.filter(r=>r.id!==t),this.pagination.total--,!0}catch(r){throw this.error=((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al eliminar cliente",r}finally{this.loading=!1}},setFilters(t){this.filters={...this.filters,...t}},clearFilters(){this.filters={search:"",document_type:"",sort_by:"created_at",sort_order:"desc"}},clearCurrentCustomer(){this.currentCustomer=null}}});export{g as u};
