import{_ as z,c as m,a as t,b as w,f as V,d as c,t as u,g as U,r as G,e as d,p as F,F as S,k as N,v as b,n as B,w as L,l as h,q as O,i as I,h as J,m as R,S as q,j as H,o as f}from"./app-CBNaHwnX.js";import{u as K}from"./invoice-BP9D02IR.js";import{u as Q}from"./customer-DM-F5ZXs.js";const W={name:"InvoiceForm",setup(){const y=O(),e=H(),x=K(),o=Q(),g=h(()=>!!y.params.id),p=I(!1),r=I(null),s=I([]),a=J({customer_id:"",description:"",notes:"",issue_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+720*60*60*1e3).toISOString().split("T")[0],status:"pending",attachment:null,items:[]}),i=h(()=>{const l=a.items.reduce((v,_)=>v+_.quantity*_.unit_price,0),n=a.items.reduce((v,_)=>{const j=_.quantity*_.unit_price;return v+j*(_.tax_rate/100)},0);return{subtotal:l,tax:n,total:l+n}}),C=async()=>{s.value=await o.fetchAllCustomers()},k=async()=>{if(g.value){p.value=!0;try{const l=await x.fetchInvoice(y.params.id);a.customer_id=l.customer.id,a.description=l.description||"",a.notes=l.notes||"",a.issue_date=l.issue_date,a.due_date=l.due_date,a.status=l.status,a.items=l.items.map(n=>({name:n.name,description:n.description||"",quantity:n.quantity,unit_price:parseFloat(n.unit_price),tax_rate:parseFloat(n.tax_rate)}))}catch{r.value="Error al cargar la factura"}finally{p.value=!1}}},D=()=>{a.items.push({name:"",description:"",quantity:1,unit_price:0,tax_rate:19})},T=l=>{a.items.splice(l,1)},A=l=>{const n=l.quantity*l.unit_price,v=n*(l.tax_rate/100);return n+v},E=l=>{const n=l.target.files[0];if(n){if(n.size>5*1024*1024){r.value="El archivo no puede superar los 5MB",l.target.value="";return}a.attachment=n}},M=async()=>{var l,n;if(a.items.length===0){r.value="Debes agregar al menos un item";return}p.value=!0,r.value=null;try{g.value?(await x.updateInvoice(y.params.id,a),q.fire("✅ Actualizada","La factura fue actualizada exitosamente","success")):(await x.createInvoice(a),q.fire("✅ Actualizada","La factura fue creada exitosamente","success")),e.push("/invoices")}catch(v){r.value=((n=(l=v.response)==null?void 0:l.data)==null?void 0:n.message)||"Error al guardar la factura"}finally{p.value=!1}},P=l=>new Intl.NumberFormat("es-CO").format(l||0);return R(()=>{C(),k(),!g.value&&a.items.length===0&&D()}),{isEditMode:g,loading:p,error:r,customers:s,formData:a,totals:i,addItem:D,removeItem:T,calculateItemTotal:A,handleFileUpload:E,handleSubmit:M,formatNumber:P}}},X={class:"invoice-form"},Y={class:"d-flex justify-content-between align-items-center mb-4"},Z={key:0,class:"alert alert-danger alert-dismissible fade show"},$={class:"card mb-4"},tt={class:"card-body"},et={class:"row"},ot={class:"col-md-6 mb-3"},st=["disabled"],lt=["value"],at={class:"col-md-6 mb-3"},nt=["disabled"],it={class:"col-md-6 mb-3"},dt=["disabled"],rt={class:"col-md-6 mb-3"},mt=["disabled"],ct={class:"col-12 mb-3"},ut=["disabled"],bt={class:"col-12 mb-3"},ft=["disabled"],vt={class:"col-12"},pt=["disabled"],_t={class:"card mb-4"},gt={class:"card-header bg-success text-white d-flex justify-content-between align-items-center"},yt=["disabled"],xt={class:"card-body"},It={key:0,class:"text-center py-4 text-muted"},Dt={class:"row"},wt={class:"col-md-3 mb-2"},Vt=["onUpdate:modelValue","disabled"],Ut={class:"col-md-2 mb-2"},Ft=["onUpdate:modelValue","disabled"],St={class:"col-md-2 mb-2"},Nt=["onUpdate:modelValue","onInput","disabled"],ht={class:"col-md-2 mb-2"},qt=["onUpdate:modelValue","onInput","disabled"],Ct={class:"col-md-2 mb-2"},kt=["onUpdate:modelValue","onInput","disabled"],Tt={class:"col-md-1 mb-2 d-flex align-items-end"},At=["onClick","disabled"],Et={class:"col-12"},Mt={class:"text-end text-muted small"},Pt={class:"card mb-4"},jt={class:"card-body"},zt={class:"row"},Gt={class:"col-md-4"},Bt={class:"table table-sm"},Lt={class:"text-end"},Ot={class:"text-end"},Jt={class:"table-primary"},Rt={class:"text-end"},Ht={class:"d-flex justify-content-end gap-2"},Kt=["disabled"],Qt={key:0},Wt={key:1};function Xt(y,e,x,o,g,p){const r=G("router-link");return f(),m("div",X,[t("div",Y,[t("h2",null,[e[10]||(e[10]=t("i",{class:"bi bi-receipt"},null,-1)),c(" "+u(o.isEditMode?"Editar Factura":"Nueva Factura"),1)]),V(r,{to:"/invoices",class:"btn btn-outline-secondary"},{default:U(()=>[...e[11]||(e[11]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),c(" Volver ",-1)])]),_:1})]),o.error?(f(),m("div",Z,[e[12]||(e[12]=t("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),c(" "+u(o.error)+" ",1),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=s=>o.error=null)})])):w("",!0),t("form",{onSubmit:e[9]||(e[9]=L((...s)=>o.handleSubmit&&o.handleSubmit(...s),["prevent"]))},[t("div",$,[e[23]||(e[23]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-info-circle me-2"}),c(" Información General ")])],-1)),t("div",tt,[t("div",et,[t("div",ot,[e[14]||(e[14]=t("label",{class:"form-label"},"Cliente *",-1)),d(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>o.formData.customer_id=s),required:"",disabled:o.loading},[e[13]||(e[13]=t("option",{value:""},"Seleccionar cliente...",-1)),(f(!0),m(S,null,N(o.customers,s=>(f(),m("option",{key:s.id,value:s.id},u(s.full_name)+" - "+u(s.document_number),9,lt))),128))],8,st),[[F,o.formData.customer_id]])]),t("div",at,[e[16]||(e[16]=t("label",{class:"form-label"},"Estado",-1)),d(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=s=>o.formData.status=s),disabled:o.loading},[...e[15]||(e[15]=[t("option",{value:"pending"},"Pendiente",-1),t("option",{value:"paid"},"Pagada",-1),t("option",{value:"overdue"},"Vencida",-1)])],8,nt),[[F,o.formData.status]])]),t("div",it,[e[17]||(e[17]=t("label",{class:"form-label"},"Fecha de Emisión *",-1)),d(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=s=>o.formData.issue_date=s),required:"",disabled:o.loading},null,8,dt),[[b,o.formData.issue_date]])]),t("div",rt,[e[18]||(e[18]=t("label",{class:"form-label"},"Fecha de Vencimiento *",-1)),d(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=s=>o.formData.due_date=s),required:"",disabled:o.loading},null,8,mt),[[b,o.formData.due_date]])]),t("div",ct,[e[19]||(e[19]=t("label",{class:"form-label"},"Descripción",-1)),d(t("textarea",{class:"form-control",rows:"2","onUpdate:modelValue":e[5]||(e[5]=s=>o.formData.description=s),placeholder:"Descripción de la factura...",disabled:o.loading},null,8,ut),[[b,o.formData.description]])]),t("div",bt,[e[20]||(e[20]=t("label",{class:"form-label"},"Notas Adicionales",-1)),d(t("textarea",{class:"form-control",rows:"2","onUpdate:modelValue":e[6]||(e[6]=s=>o.formData.notes=s),placeholder:"Notas adicionales...",disabled:o.loading},null,8,ft),[[b,o.formData.notes]])]),t("div",vt,[e[21]||(e[21]=t("label",{class:"form-label"},"Archivo Adjunto (PDF, JPG, PNG - Máx. 5MB)",-1)),t("input",{type:"file",class:"form-control",onChange:e[7]||(e[7]=(...s)=>o.handleFileUpload&&o.handleFileUpload(...s)),accept:".pdf,.jpg,.jpeg,.png",disabled:o.loading},null,40,pt),e[22]||(e[22]=t("small",{class:"text-muted"},"Formatos permitidos: PDF, JPG, PNG",-1))])])])]),t("div",_t,[t("div",gt,[e[25]||(e[25]=t("h5",{class:"mb-0"},[t("i",{class:"bi bi-list-ul me-2"}),c(" Items de la Factura ")],-1)),t("button",{type:"button",class:"btn btn-light btn-sm",onClick:e[8]||(e[8]=(...s)=>o.addItem&&o.addItem(...s)),disabled:o.loading},[...e[24]||(e[24]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),c(" Agregar Item ",-1)])],8,yt)]),t("div",xt,[o.formData.items.length===0?(f(),m("div",It,[...e[26]||(e[26]=[t("i",{class:"bi bi-inbox",style:{"font-size":"2rem"}},null,-1),t("p",{class:"mt-2"},"No hay items agregados",-1)])])):w("",!0),(f(!0),m(S,null,N(o.formData.items,(s,a)=>(f(),m("div",{key:a,class:"item-row mb-3 p-3 border rounded"},[t("div",Dt,[t("div",wt,[e[27]||(e[27]=t("label",{class:"form-label small"},"Nombre *",-1)),d(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":i=>s.name=i,placeholder:"Nombre del item",required:"",disabled:o.loading},null,8,Vt),[[b,s.name]])]),t("div",Ut,[e[28]||(e[28]=t("label",{class:"form-label small"},"Descripción",-1)),d(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":i=>s.description=i,placeholder:"Descripción",disabled:o.loading},null,8,Ft),[[b,s.description]])]),t("div",St,[e[29]||(e[29]=t("label",{class:"form-label small"},"Cantidad *",-1)),d(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":i=>s.quantity=i,min:"1",required:"",onInput:i=>o.calculateItemTotal(s),disabled:o.loading},null,40,Nt),[[b,s.quantity,void 0,{number:!0}]])]),t("div",ht,[e[30]||(e[30]=t("label",{class:"form-label small"},"Precio Unit. *",-1)),d(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":i=>s.unit_price=i,min:"0",step:"0.01",required:"",onInput:i=>o.calculateItemTotal(s),disabled:o.loading},null,40,qt),[[b,s.unit_price,void 0,{number:!0}]])]),t("div",Ct,[e[31]||(e[31]=t("label",{class:"form-label small"},"IVA (%) *",-1)),d(t("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":i=>s.tax_rate=i,min:"0",max:"100",step:"0.01",required:"",onInput:i=>o.calculateItemTotal(s),disabled:o.loading},null,40,kt),[[b,s.tax_rate,void 0,{number:!0}]])]),t("div",Tt,[t("button",{type:"button",class:"btn btn-danger btn-sm w-100",onClick:i=>o.removeItem(a),disabled:o.loading},[...e[32]||(e[32]=[t("i",{class:"bi bi-trash"},null,-1)])],8,At)]),t("div",Et,[t("div",Mt," Total: $"+u(o.formatNumber(o.calculateItemTotal(s))),1)])])]))),128))])]),t("div",Pt,[t("div",jt,[t("div",zt,[e[36]||(e[36]=t("div",{class:"col-md-8"},null,-1)),t("div",Gt,[t("table",Bt,[t("tr",null,[e[33]||(e[33]=t("td",null,[t("strong",null,"Subtotal:")],-1)),t("td",Lt," $"+u(o.formatNumber(o.totals.subtotal)),1)]),t("tr",null,[e[34]||(e[34]=t("td",null,[t("strong",null,"IVA:")],-1)),t("td",Ot," $"+u(o.formatNumber(o.totals.tax)),1)]),t("tr",Jt,[e[35]||(e[35]=t("td",null,[t("strong",null,"TOTAL:")],-1)),t("td",Rt,[t("strong",null,"$"+u(o.formatNumber(o.totals.total)),1)])])])])])])]),t("div",Ht,[V(r,{to:"/invoices",class:B(["btn btn-outline-secondary",{disabled:o.loading}])},{default:U(()=>[...e[37]||(e[37]=[c(" Cancelar ",-1)])]),_:1},8,["class"]),t("button",{type:"submit",class:"btn btn-primary",disabled:o.loading||o.formData.items.length===0},[o.loading?(f(),m("span",Qt,[...e[38]||(e[38]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),c(" Guardando... ",-1)])])):(f(),m("span",Wt,[e[39]||(e[39]=t("i",{class:"bi bi-save me-2"},null,-1)),c(" "+u(o.isEditMode?"Actualizar":"Guardar")+" Factura ",1)]))],8,Kt)])],32)])}const te=z(W,[["render",Xt],["__scopeId","data-v-f9c9510a"]]);export{te as default};
