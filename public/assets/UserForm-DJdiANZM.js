import{_ as D,c as i,a,b as y,f as _,d as n,g as x,r as S,t as U,w as V,y as N,e as m,v,p as h,n as E,u as M,i as w,h as j,l as z,q as A,m as q,S as L,j as R,o as d}from"./app-CBNaHwnX.js";import{u as T}from"./user-C5WNbEoy.js";const B={name:"UserForm",setup(){const c=A(),s=R(),u=T(),o=M(),b=w(!1),f=w(!1),r=w(null),e=w(null),l=j({name:"",email:"",role:"",password:"",password_confirmation:""}),g=z(()=>{var t;return((t=o.user)==null?void 0:t.id)===parseInt(c.params.id)}),C=async()=>{var t;b.value=!0;try{const p=await u.fetchUser(c.params.id);l.name=p.name,l.email=p.email,l.role=((t=p.roles)==null?void 0:t[0])||""}catch{r.value="Error al cargar el usuario"}finally{b.value=!1}},k=async()=>{if(l.password){if(l.password.length<8){r.value="La contraseña debe tener al menos 8 caracteres";return}if(l.password!==l.password_confirmation){r.value="Las contraseñas no coinciden";return}}f.value=!0,r.value=null,e.value=null;try{const t={name:l.name,email:l.email,role:l.role};l.password&&(t.password=l.password,t.password_confirmation=l.password_confirmation),await u.updateUser(c.params.id,t),L.fire("✅ Actualizado","El usuario fue actualizado exitosamente","success"),g.value&&await o.fetchUser(),setTimeout(()=>{s.push("/users")},1500)}catch{r.value=u.error||"Error al actualizar el usuario"}finally{f.value=!1}};return q(()=>{C()}),{initialLoading:b,loading:f,error:r,success:e,formData:l,isCurrentUser:g,handleSubmit:k}}},I={class:"user-form"},F={class:"d-flex justify-content-between align-items-center mb-4"},G={key:0,class:"alert alert-danger alert-dismissible fade show"},O={key:1,class:"alert alert-success alert-dismissible fade show"},H={key:2,class:"text-center py-5"},J={key:3,class:"row"},K={class:"col-md-8 mx-auto"},P={class:"card"},Q={class:"card-body"},W={class:"row"},X={class:"col-12 mb-3"},Y=["disabled"],Z={class:"col-12 mb-3"},$=["disabled"],ss={class:"col-12 mb-3"},as=["disabled"],os={key:0,class:"text-muted"},es={class:"col-md-6 mb-3"},ls=["disabled"],ts={class:"col-md-6 mb-3"},rs=["disabled"],is={class:"d-flex justify-content-end gap-2 mt-4"},ns=["disabled"],ds={key:0},ms={key:1};function cs(c,s,u,o,b,f){const r=S("router-link");return d(),i("div",I,[a("div",F,[s[9]||(s[9]=a("h2",null,[a("i",{class:"bi bi-person-gear"}),n(" Editar Usuario "),a("span",{class:"badge bg-warning text-dark ms-2"},"Admin")],-1)),_(r,{to:"/users",class:"btn btn-outline-secondary"},{default:x(()=>[...s[8]||(s[8]=[a("i",{class:"bi bi-arrow-left me-2"},null,-1),n(" Volver ",-1)])]),_:1})]),o.error?(d(),i("div",G,[s[10]||(s[10]=a("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),n(" "+U(o.error)+" ",1),a("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=e=>o.error=null)})])):y("",!0),o.success?(d(),i("div",O,[s[11]||(s[11]=a("i",{class:"bi bi-check-circle-fill me-2"},null,-1)),n(" "+U(o.success)+" ",1),a("button",{type:"button",class:"btn-close",onClick:s[1]||(s[1]=e=>o.success=null)})])):y("",!0),o.initialLoading?(d(),i("div",H,[...s[12]||(s[12]=[a("div",{class:"spinner-border text-primary",role:"status"},[a("span",{class:"visually-hidden"},"Cargando...")],-1),a("p",{class:"mt-3 text-muted"},"Cargando usuario...",-1)])])):(d(),i("div",J,[a("div",K,[a("div",P,[s[24]||(s[24]=a("div",{class:"card-header bg-primary text-white"},[a("h5",{class:"mb-0"},[a("i",{class:"bi bi-person-badge me-2"}),n(" Información del Usuario ")])],-1)),a("div",Q,[a("form",{onSubmit:s[7]||(s[7]=V((...e)=>o.handleSubmit&&o.handleSubmit(...e),["prevent"]))},[a("div",W,[a("div",X,[s[13]||(s[13]=a("label",{class:"form-label"},"Nombre Completo *",-1)),m(a("input",{type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=e=>o.formData.name=e),placeholder:"Nombre completo",required:"",disabled:o.loading},null,8,Y),[[v,o.formData.name]])]),a("div",Z,[s[14]||(s[14]=a("label",{class:"form-label"},"Email *",-1)),m(a("input",{type:"email",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>o.formData.email=e),placeholder:"correo@ejemplo.com",required:"",disabled:o.loading},null,8,$),[[v,o.formData.email]])]),a("div",ss,[s[16]||(s[16]=a("label",{class:"form-label"},"Rol *",-1)),m(a("select",{class:"form-select","onUpdate:modelValue":s[4]||(s[4]=e=>o.formData.role=e),required:"",disabled:o.loading||o.isCurrentUser},[...s[15]||(s[15]=[a("option",{value:""},"Seleccionar rol...",-1),a("option",{value:"admin"},"Administrador",-1),a("option",{value:"user"},"Usuario",-1)])],8,as),[[h,o.formData.role]]),o.isCurrentUser?(d(),i("small",os," No puedes cambiar tu propio rol ")):y("",!0)]),s[20]||(s[20]=N('<hr class="my-4" data-v-a04dbc8f><div class="col-12 mb-3" data-v-a04dbc8f><h6 class="text-muted" data-v-a04dbc8f><i class="bi bi-shield-lock me-2" data-v-a04dbc8f></i> Cambiar Contraseña (opcional) </h6><small class="text-muted" data-v-a04dbc8f> Deja estos campos vacíos si no deseas cambiar la contraseña </small></div>',2)),a("div",es,[s[17]||(s[17]=a("label",{class:"form-label"},"Nueva Contraseña",-1)),m(a("input",{type:"password",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=e=>o.formData.password=e),placeholder:"Mínimo 8 caracteres",minlength:"8",disabled:o.loading},null,8,ls),[[v,o.formData.password]]),s[18]||(s[18]=a("small",{class:"text-muted"}," Opcional - Mínimo 8 caracteres ",-1))]),a("div",ts,[s[19]||(s[19]=a("label",{class:"form-label"},"Confirmar Contraseña",-1)),m(a("input",{type:"password",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=e=>o.formData.password_confirmation=e),placeholder:"Repite la contraseña",disabled:o.loading||!o.formData.password},null,8,rs),[[v,o.formData.password_confirmation]])])]),a("div",is,[_(r,{to:"/users",class:E(["btn btn-outline-secondary",{disabled:o.loading}])},{default:x(()=>[...s[21]||(s[21]=[n(" Cancelar ",-1)])]),_:1},8,["class"]),a("button",{type:"submit",class:"btn btn-primary",disabled:o.loading},[o.loading?(d(),i("span",ds,[...s[22]||(s[22]=[a("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),n(" Guardando... ",-1)])])):(d(),i("span",ms,[...s[23]||(s[23]=[a("i",{class:"bi bi-save me-2"},null,-1),n(" Actualizar Usuario ",-1)])]))],8,ns)])],32)])])])]))])}const fs=D(B,[["render",cs],["__scopeId","data-v-a04dbc8f"]]);export{fs as default};
